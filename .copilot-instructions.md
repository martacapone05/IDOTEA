# Regole di Sviluppo - PoliPhaser ONLY

## ‚ö†Ô∏è REGOLA FONDAMENTALE
**MAI usare codice Phaser diretto. SEMPRE usare PoliPhaser (PP.*).**

---

## ‚ùå Pattern VIETATI (da non usare MAI)

```javascript
// MAI accedere direttamente alla camera Phaser
s.cameras.main.setDeadzone(...)
s.cameras.main.startFollow(...)
s.cameras.main.anything(...)

// MAI usare this.add, this.physics, etc.
this.add.sprite(...)
this.physics.add(...)
this.tweens.add(...)

// MAI usare Phaser.* nel codice utente
Phaser.Input.Keyboard.KeyCodes
new Phaser.Scene(...)
```

---

## ‚úÖ Pattern CORRETTI (usare SEMPRE)

```javascript
// Camera
PP.camera.start_follow(s, player, offset_x, offset_y);
PP.camera.set_follow_offset(s, offset_x, offset_y);
PP.camera.set_deadzone(s, width, height);
PP.camera.get_scroll_x(s);
PP.camera.get_scroll_y(s);

// Physics
PP.physics.add(s, obj, PP.physics.type.STATIC);
PP.physics.add(s, obj, PP.physics.type.DYNAMIC);
PP.physics.add_collider(s, obj1, obj2);
PP.physics.add_collider_f(s, obj1, obj2, callback);
PP.physics.add_overlap_f(s, obj1, obj2, callback);
PP.physics.set_velocity_x(obj, vel);
PP.physics.set_velocity_y(obj, vel);
PP.physics.get_velocity_x(obj);
PP.physics.get_velocity_y(obj);
PP.physics.set_allow_gravity(obj, bool);
PP.physics.set_collision_rectangle(obj, x, y, w, h);

// Assets
PP.assets.image.load(s, path);
PP.assets.image.add(s, img, x, y, pivot_x, pivot_y);
PP.assets.sprite.load_spritesheet(s, path, frame_w, frame_h);
PP.assets.sprite.add(s, spritesheet, x, y, pivot_x, pivot_y);
PP.assets.sprite.animation_add(sprite, name, start, end, fps, repeat);
PP.assets.sprite.animation_add_list(sprite, name, frames_array, fps, repeat);
PP.assets.sprite.animation_play(sprite, name);
PP.assets.tilesprite.add(s, img, x, y, w, h, pivot_x, pivot_y);
PP.assets.destroy(obj);

// Shapes
PP.shapes.rectangle_add(s, x, y, w, h, color, alpha);
PP.shapes.set_stroke(obj, width, color, alpha);
PP.shapes.text_styled_add(s, x, y, text, size, font, style, color, bg, pivot_x, pivot_y);
PP.shapes.text_change(text_obj, new_text);
PP.shapes.destroy(obj);

// Layers
PP.layers.set_z_index(obj, z);

// Input
PP.interactive.kb.is_key_down(s, PP.key_codes.SPACE);
PP.interactive.kb.is_key_down(s, PP.key_codes.LEFT);
PP.interactive.kb.is_key_down(s, PP.key_codes.RIGHT);
PP.interactive.kb.is_key_down(s, PP.key_codes.UP);
PP.interactive.kb.is_key_down(s, PP.key_codes.DOWN);
PP.interactive.kb.is_key_down(s, PP.key_codes.E);

// Timers
PP.timers.add_timer(s, delay_ms, callback, loop);

// Scenes
PP.scenes.add(name, preload, create, update, destroy);
PP.scenes.start(name);

// Game State
PP.game_state.set_variable(key, value);
PP.game_state.get_variable(key);

// Game Config
PP.game.create(config);
PP.game.config.canvas_width;
PP.game.config.canvas_height;
```

---

## üìê Propriet√† degli oggetti PoliPhaser

```javascript
// Geometria
obj.geometry.x
obj.geometry.y
obj.geometry.scale_x
obj.geometry.scale_y
obj.geometry.flip_x
obj.geometry.flip_y
obj.geometry.angle
obj.geometry.display_width
obj.geometry.display_height

// Tile Geometry (per tilesprite e UI fissa)
obj.tile_geometry.x
obj.tile_geometry.y
obj.tile_geometry.scroll_factor_x  // 0 = fisso su schermo
obj.tile_geometry.scroll_factor_y  // 0 = fisso su schermo

// Visibility
obj.visibility.alpha
obj.visibility.hidden
```

---

## üîç Come verificare che il codice sia pulito

Esegui questa ricerca regex nel progetto (escludi lib/):
```
s\.cameras|this\.add\.|this\.physics\.|this\.tweens\.|Phaser\.(?!min\.js)
```

Se trova match nei file src/, c'√® codice Phaser da convertire.

---

## üìù Errori gi√† corretti in questo progetto

1. **Dead zone camera** - Era `s.cameras.main.setDeadzone()` ‚Üí Ora `PP.camera.set_deadzone()`
   - File corretti: lvl1_pt1.js, lvl1_pt2.js, lvl1_pt3.js, lvl2.js, lvl3.js
   - Aggiunta funzione `PP.camera.set_deadzone()` in poliphaser.js

---

*Ultimo aggiornamento: 10 Gennaio 2026*
